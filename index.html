<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini Marketplace</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1 class="main-title">Mini Marketplace</h1>

      <div class="layout">
        <section class="products-section">
          <h2>Products</h2>
          <div id="products-loading" class="loading">Loading products...</div>
          <div id="products-grid" class="products-grid"></div>
        </section>

        <section class="cart-section">
          <div id="cart-root"></div>
        </section>
      </div>
    </div>

    <script src="vanilla/products.js"></script>

    <script
      crossorigin
      src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"
    ></script>
    <script src="react/components/CartItem.jsx" type="text/babel"></script>
    <script src="react/components/CartList.jsx" type="text/babel"></script>
    <script src="react/App.jsx" type="text/babel"></script>
    <script src="react/main.jsx" type="text/babel"></script>
<link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>


    <script>
      (function () {
        const productsGrid = document.getElementById("products-grid");
        const loadingEl = document.getElementById("products-loading");

        fetch("https://fakestoreapi.com/products")
          .then((response) => response.json())
          .then((products) => {
            loadingEl.style.display = "none";
            renderProducts(products);
          })
          .catch((error) => {
            console.error("Error loading products:", error);
            loadingEl.textContent = "Error loading products. Please try again.";
          });

        function renderProducts(products) {
          productsGrid.innerHTML = "";

          products.forEach((product) => {
            const card = createProductCard(product);
            productsGrid.appendChild(card);
          });
        }

        function createProductCard(product) {
          const card = document.createElement("div");
          card.className = "product-card";

          const img = document.createElement("img");
          img.src = product.image;
          img.alt = product.title;

          const title = document.createElement("h3");
          title.textContent = product.title;

          const price = document.createElement("p");
          price.className = "price";
          price.textContent = `$${product.price.toFixed(2)}`;

          const button = document.createElement("button");
          button.textContent = "Add to Cart";
          button.addEventListener("click", () => {
            addToCart(product);
          });

          card.appendChild(img);
          card.appendChild(title);
          card.appendChild(price);
          card.appendChild(button);

          return card;
        }

        function addToCart(product) {
          const event = new CustomEvent("addToCart", {
            detail: product,
          });
          window.dispatchEvent(event);
        }

        window.addToCart = addToCart;
      })();
    </script>

    <script type="text/babel">
      const CartItem = ({ item, onRemove }) => {
        return (
          <div className="cart-item">
            <img src={item.image} alt={item.title} />
            <div className="cart-item-info">
              <h4>{item.title}</h4>
              <p>${item.price.toFixed(2)}</p>
            </div>
            <button onClick={() => onRemove(item.id)}>Remove</button>
          </div>
        );
      };

      window.CartItem = CartItem;
    </script>

    <script type="text/babel">
      const CartList = ({ items, onRemove }) => {
        const total = items.reduce((sum, item) => sum + item.price, 0);

        return (
          <div>
            <h2>Cart ({items.length})</h2>
            {items.length === 0 ? (
              <p className="cart-empty">Your cart is empty</p>
            ) : (
              <>
                <div>
                  {items.map((item, index) => (
                    <CartItem
                      key={`${item.id}-${index}`}
                      item={item}
                      onRemove={onRemove}
                    />
                  ))}
                </div>
                <div className="cart-total">
                  <h3>
                    Total: <span>${total.toFixed(2)}</span>
                  </h3>
                </div>
              </>
            )}
          </div>
        );
      };

      window.CartList = CartList;
    </script>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function App() {
        const [cart, setCart] = useState([]);

        useEffect(() => {
          const savedCart = localStorage.getItem("cart");
          if (savedCart) {
            try {
              setCart(JSON.parse(savedCart));
            } catch (e) {
              console.error("Error loading cart:", e);
            }
          }
        }, []);

        useEffect(() => {
          localStorage.setItem("cart", JSON.stringify(cart));
        }, [cart]);

        useEffect(() => {
          const handleAddToCart = (event) => {
            const product = event.detail;
            setCart((prevCart) => [...prevCart, product]);
          };

          window.addEventListener("addToCart", handleAddToCart);

          return () => {
            window.removeEventListener("addToCart", handleAddToCart);
          };
        }, []);

        const removeFromCart = (productId) => {
          const index = cart.findIndex((item) => item.id === productId);
          if (index > -1) {
            const newCart = [...cart];
            newCart.splice(index, 1);
            setCart(newCart);
          }
        };

        return (
          <div className="cart-container">
            <CartList items={cart} onRemove={removeFromCart} />
          </div>
        );
      }

      window.App = App;
    </script>

    <script type="text/babel">
      const root = ReactDOM.createRoot(document.getElementById("cart-root"));
      root.render(<App />);
    </script>
  </body>
</html>
