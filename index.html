<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini Marketplace</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1 class="main-title">Mini Marketplace</h1>

      <div class="layout">
        <section class="products-section">
          <h2>Products</h2>
          <div id="products-loading" class="loading">Loading products...</div>
          <div id="products-grid" class="products-grid"></div>
        </section>

        <section class="cart-section">
          <div id="cart-root"></div>
        </section>
      </div>
    </div>

    <script src="vanilla/products.js"></script>

    <script
      crossorigin
      src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"
    ></script>
    <script src="react/components/CartItem.jsx" type="text/babel"></script>
    <script src="react/components/CartList.jsx" type="text/babel"></script>
    <script src="react/App.jsx" type="text/babel"></script>
    <script src="react/main.jsx" type="text/babel"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <style>
      /* style.css */

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background-color: #f5f5f5;
        color: #2c3e50;
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .main-title {
        text-align: center;
        font-size: 32px;
        margin-bottom: 30px;
        color: #2c3e50;
      }

      .layout {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
      }

      /* Products Section */
      .products-section h2 {
        font-size: 24px;
        margin-bottom: 20px;
      }

      .loading {
        text-align: center;
        color: #7f8c8d;
        padding: 40px;
        font-size: 16px;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
      }

      .product-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        height: 100%;
        transition: box-shadow 0.2s, transform 0.2s;
      }

      .product-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }

      .product-card img {
        width: 100%;
        height: 200px;
        object-fit: contain;
        margin-bottom: 15px;
      }

      .product-card h3 {
        font-size: 16px;
        margin-bottom: 10px;
        height: 48px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .product-card .price {
        font-size: 20px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 15px;
      }

      .product-card button {
        margin-top: auto;
        padding: 12px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: background-color 0.2s;
      }

      .product-card button:hover {
        background-color: #2980b9;
      }

      .product-card button:active {
        background-color: #1c5980;
        transform: scale(0.98);
      }

      /* Cart Section */
      .cart-section {
        position: sticky;
        top: 20px;
        height: fit-content;
      }

      .cart-container {
        background: white;
        border: 2px solid #3498db;
        border-radius: 8px;
        padding: 20px;
      }

      .cart-container h2 {
        font-size: 24px;
        margin-bottom: 20px;
      }

      .cart-empty {
        color: #7f8c8d;
        text-align: center;
        padding: 40px 20px;
      }

      .cart-item {
        display: flex;
        gap: 15px;
        padding: 15px;
        border-bottom: 1px solid #e0e0e0;
        align-items: center;
      }

      .cart-item img {
        width: 60px;
        height: 60px;
        object-fit: contain;
      }

      .cart-item-info {
        flex: 1;
      }

      .cart-item-info h4 {
        margin: 0 0 8px 0;
        font-size: 14px;
      }

      .cart-item-info p {
        margin: 0;
        font-size: 16px;
        font-weight: bold;
        color: #2c3e50;
      }

      .cart-item button {
        padding: 8px 16px;
        background-color: #e74c3c;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .cart-item button:hover {
        background-color: #c0392b;
      }

      .cart-item button:active {
        background-color: #a93226;
        transform: scale(0.98);
      }

      .cart-total {
        padding: 20px;
        background-color: #ecf0f1;
        border-radius: 4px;
        text-align: right;
        margin-top: 20px;
      }

      .cart-total h3 {
        margin: 0;
        font-size: 20px;
      }

      .cart-total span {
        color: #27ae60;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .layout {
          grid-template-columns: 1fr;
        }

        .cart-section {
          position: static;
        }

        .products-grid {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
      }

      @media (max-width: 480px) {
        .products-grid {
          grid-template-columns: 1fr;
        }

        .main-title {
          font-size: 24px;
        }
      }
    </style>

    <script>
      (function () {
        const productsGrid = document.getElementById("products-grid");
        const loadingEl = document.getElementById("products-loading");

        fetch("https://fakestoreapi.com/products")
          .then((response) => response.json())
          .then((products) => {
            loadingEl.style.display = "none";
            renderProducts(products);
          })
          .catch((error) => {
            console.error("Error loading products:", error);
            loadingEl.textContent = "Error loading products. Please try again.";
          });

        function renderProducts(products) {
          productsGrid.innerHTML = "";

          products.forEach((product) => {
            const card = createProductCard(product);
            productsGrid.appendChild(card);
          });
        }

        function createProductCard(product) {
          const card = document.createElement("div");
          card.className = "product-card";

          const img = document.createElement("img");
          img.src = product.image;
          img.alt = product.title;

          const title = document.createElement("h3");
          title.textContent = product.title;

          const price = document.createElement("p");
          price.className = "price";
          price.textContent = `$${product.price.toFixed(2)}`;

          const button = document.createElement("button");
          button.textContent = "Add to Cart";
          button.addEventListener("click", () => {
            addToCart(product);
          });

          card.appendChild(img);
          card.appendChild(title);
          card.appendChild(price);
          card.appendChild(button);

          return card;
        }

        function addToCart(product) {
          const event = new CustomEvent("addToCart", {
            detail: product,
          });
          window.dispatchEvent(event);
        }

        window.addToCart = addToCart;
      })();
    </script>

    <script type="text/babel">
      const CartItem = ({ item, onRemove }) => {
        return (
          <div className="cart-item">
            <img src={item.image} alt={item.title} />
            <div className="cart-item-info">
              <h4>{item.title}</h4>
              <p>${item.price.toFixed(2)}</p>
            </div>
            <button onClick={() => onRemove(item.id)}>Remove</button>
          </div>
        );
      };

      window.CartItem = CartItem;
    </script>

    <script type="text/babel">
      const CartList = ({ items, onRemove }) => {
        const total = items.reduce((sum, item) => sum + item.price, 0);

        return (
          <div>
            <h2>Cart ({items.length})</h2>
            {items.length === 0 ? (
              <p className="cart-empty">Your cart is empty</p>
            ) : (
              <>
                <div>
                  {items.map((item, index) => (
                    <CartItem
                      key={`${item.id}-${index}`}
                      item={item}
                      onRemove={onRemove}
                    />
                  ))}
                </div>
                <div className="cart-total">
                  <h3>
                    Total: <span>${total.toFixed(2)}</span>
                  </h3>
                </div>
              </>
            )}
          </div>
        );
      };

      window.CartList = CartList;
    </script>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function App() {
        const [cart, setCart] = useState([]);

        useEffect(() => {
          const savedCart = localStorage.getItem("cart");
          if (savedCart) {
            try {
              setCart(JSON.parse(savedCart));
            } catch (e) {
              console.error("Error loading cart:", e);
            }
          }
        }, []);

        useEffect(() => {
          localStorage.setItem("cart", JSON.stringify(cart));
        }, [cart]);

        useEffect(() => {
          const handleAddToCart = (event) => {
            const product = event.detail;
            setCart((prevCart) => [...prevCart, product]);
          };

          window.addEventListener("addToCart", handleAddToCart);

          return () => {
            window.removeEventListener("addToCart", handleAddToCart);
          };
        }, []);

        const removeFromCart = (productId) => {
          const index = cart.findIndex((item) => item.id === productId);
          if (index > -1) {
            const newCart = [...cart];
            newCart.splice(index, 1);
            setCart(newCart);
          }
        };

        return (
          <div className="cart-container">
            <CartList items={cart} onRemove={removeFromCart} />
          </div>
        );
      }

      window.App = App;
    </script>

    <script type="text/babel">
      const root = ReactDOM.createRoot(document.getElementById("cart-root"));
      root.render(<App />);
    </script>
  </body>
</html>
